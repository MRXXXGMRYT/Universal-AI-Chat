<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Universal AI Chat</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <!-- Code highlight -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

  <style>
    html, body { height:100%; background:#f7f7f8; }
    #app { min-height:100vh; display:flex; flex-direction:column; }
    #loading { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:white; z-index:60; }
    .sidebar { width:320px; max-width:85vw; }
  </style>
</head>

<body>

<div id="loading">Loading App...</div>

<div id="app" class="min-h-screen flex flex-col"><header class="flex items-center justify-between px-4 py-3 border-b bg-white">
  <div class="flex items-center gap-3">
    <button id="hamburger" class="sm:hidden">â˜°</button>
    <h1 class="text-lg font-semibold">Universal AI Chat</h1>
  </div>

  <div class="flex gap-2">
    <button id="btnSystem">System</button>
    <button id="btnSettings">Settings</button>
    <button id="toggleTheme">ðŸŒ™</button>
  </div>
</header>

<main class="flex flex-1 min-h-0">

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar hidden sm:flex flex-col border-r bg-white">
    <div class="p-3 border-b flex justify-between">
      <strong>Chats</strong>
      <button id="btnNewChat" class="bg-blue-600 text-white px-2 py-1 rounded">New</button>
    </div>
    <div id="chatsList" class="flex-1 overflow-auto p-2"></div>
  </aside>

  <!-- Chat Area -->
  <section class="flex-1 flex flex-col bg-[#f7f7f8]">

    <div id="messagesContainer" class="flex-1 overflow-auto p-4 space-y-4">
    </div>

    <!-- Input bar -->
    <footer class="fixed bottom-0 left-0 right-0 p-3 border-t bg-white">
      <div class="max-w-4xl mx-auto flex gap-2">
        <textarea id="inputBox" rows="1" class="flex-1 border rounded p-2" placeholder="Send a message..."></textarea>
        <button id="btnSend" class="bg-blue-600 text-white px-4 rounded">Send</button>
      </div>
    </footer>

  </section>
</main><!-- Settings Modal -->
<div id="modalBackdrop" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
  <div class="bg-white p-4 rounded w-full max-w-md">
    <h3 class="font-semibold mb-2">Settings</h3>

    <label class="text-sm">OpenRouter API Key</label>
    <input id="apiKeyInput" type="password" class="w-full border p-2 rounded mb-2">

    <label class="text-sm">Model</label>
    <input id="modelInput" class="w-full border p-2 rounded mb-2" placeholder="deepseek/deepseek-r1:free">

    <button id="saveSettings" class="bg-blue-600 text-white px-3 py-2 rounded">Save</button>
    <button id="closeSettings" class="ml-2">Close</button>
  </div>
</div>

<!-- System Prompt Modal -->
<div id="modalSystem" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
  <div class="bg-white p-4 rounded w-full max-w-md">
    <h3 class="font-semibold mb-2">System Prompt</h3>
    <textarea id="systemPromptInput" rows="6" class="w-full border p-2 rounded"></textarea>

    <button id="saveSystem" class="bg-blue-600 text-white px-3 py-2 rounded">Save</button>
    <button id="closeSystem" class="ml-2">Close</button>
  </div>
</div><script>
(function(){

// Hide loader
document.getElementById("loading").style.display = "none";

// LocalStorage keys
const LS = {
  key:"apiKey",
  model:"model",
  chats:"chats",
  theme:"theme",
  system:"system"
};

let apiKey = localStorage.getItem(LS.key) || "";
let model = localStorage.getItem(LS.model) || "deepseek/deepseek-r1:free";
let chats = JSON.parse(localStorage.getItem(LS.chats) || "[]");
let systemPrompt = localStorage.getItem(LS.system) || "";

// DOM
const messagesContainer = document.getElementById("messagesContainer");
const inputBox = document.getElementById("inputBox");

// Send message
document.getElementById("btnSend").onclick = async () => {
  const text = inputBox.value.trim();
  if(!text) return;

  addMessage("user", text);
  inputBox.value = "";

  addMessage("assistant", "Thinking...");

  const response = await fetch("https://openrouter.ai/api/v1/chat/completions",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer " + apiKey
    },
    body:JSON.stringify({
      model:model,
      messages:[
        {role:"system", content:systemPrompt},
        {role:"user", content:text}
      ]
    })
  });

  const data = await response.json();
  const reply = data.choices?.[0]?.message?.content || "Error";

  updateLastAssistant(reply);
};

function addMessage(role, content){
  const div = document.createElement("div");
  div.className = role==="user" ? "text-right" : "text-left";
  div.innerHTML = "<div class='inline-block bg-white p-3 rounded shadow'>" +
    marked.parse(content) +
    "</div>";
  messagesContainer.appendChild(div);
  messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function updateLastAssistant(text){
  const msgs = messagesContainer.children;
  const last = msgs[msgs.length-1];
  if(last) last.innerHTML =
    "<div class='inline-block bg-white p-3 rounded shadow'>" +
    marked.parse(text) +
    "</div>";
}

// Settings
document.getElementById("btnSettings").onclick = ()=> modalBackdrop.classList.remove("hidden");
document.getElementById("closeSettings").onclick = ()=> modalBackdrop.classList.add("hidden");

document.getElementById("saveSettings").onclick = ()=>{
  apiKey = apiKeyInput.value;
  model = modelInput.value;
  localStorage.setItem(LS.key, apiKey);
  localStorage.setItem(LS.model, model);
  modalBackdrop.classList.add("hidden");
};

// System prompt
document.getElementById("btnSystem").onclick = ()=> modalSystem.classList.remove("hidden");
document.getElementById("closeSystem").onclick = ()=> modalSystem.classList.add("hidden");

document.getElementById("saveSystem").onclick = ()=>{
  systemPrompt = systemPromptInput.value;
  localStorage.setItem(LS.system, systemPrompt);
  modalSystem.classList.add("hidden");
};

})();
</script>

</div>
</body>
</html>